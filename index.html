<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Prontuário – Pilates & Fisioterapia</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background:#eef1f7;
  margin:0;
  padding:20px;
}
h1{text-align:center;margin-bottom:20px}
h2{margin-top:30px}
.card{
  background:#fff;
  padding:20px;
  border-radius:10px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}
label{
  font-weight:bold;
  display:block;
  margin-top:12px;
}
select,input,textarea{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:6px;
  border:1px solid #ccc;
}
textarea{min-height:80px}
button{
  padding:12px 18px;
  border:none;
  border-radius:8px;
  background:#4b3fd1;
  color:#fff;
  cursor:pointer;
  margin-top:15px;
}
.menu{
  display:flex;
  gap:10px;
  margin-bottom:20px;
}
.hidden{display:none}
.paciente{
  background:#f3f3f3;
  padding:15px;
  border-radius:8px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<h1>Sistema de Avaliação – Studio</h1>

<div class="menu">
  <button onclick="mostrar('form')">Nova Avaliação</button>
  <button onclick="mostrar('pacientes')">Pacientes</button>
</div>

<!-- ================= FORMULÁRIO ================= -->
<div id="form" class="card">

<label>Tipo de Avaliação</label>
<select id="tipo" onchange="trocarTipo()">
  <option value="pilates">Pilates</option>
  <option value="fisioterapia">Fisioterapia</option>
</select>

<h2>Identificação</h2>
<label>Nome do Paciente</label>
<input id="nome">

<label>Data</label>
<input type="date" id="data">

<label>Telefone</label>
<input id="telefone">

<!-- ================= PILATES ================= -->
<div id="pilates">

<h2>Avaliação de Pilates</h2>

<label>Convênio</label>
<select id="pil_conv">
  <option>Particular</option>
  <option>Gympass</option>
  <option>TotalPass</option>
  <option>Outro</option>
</select>
<textarea id="pil_conv_obs" placeholder="Observações"></textarea>

<label>Objetivo</label>
<select id="pil_obj">
  <option>Dor</option>
  <option>Condicionamento</option>
  <option>Reabilitação</option>
  <option>Prevenção</option>
</select>
<textarea id="pil_obj_obs" placeholder="Observações"></textarea>

<label>Histórico de Dor</label>
<select id="pil_dor">
  <option>Sim</option>
  <option>Não</option>
</select>
<textarea id="pil_dor_obs"></textarea>

<label>Avaliação Postural</label>
<select id="pil_post">
  <option>Alinhado</option>
  <option>Assimetria</option>
</select>
<textarea id="pil_post_obs"></textarea>

<label>Mobilidade</label>
<select id="pil_mob">
  <option>Boa</option>
  <option>Regular</option>
  <option>Ruim</option>
</select>
<textarea id="pil_mob_obs"></textarea>

<label>Equilíbrio</label>
<select id="pil_eq">
  <option>Bom</option>
  <option>Regular</option>
  <option>Ruim</option>
</select>
<textarea id="pil_eq_obs"></textarea>

<label>EVA (Dor)</label>
<select id="pil_eva">
  <option>0–2</option>
  <option>3–5</option>
  <option>6–8</option>
  <option>9–10</option>
</select>
<textarea id="pil_eva_obs"></textarea>

<label>Plano Terapêutico</label>
<textarea id="pil_plano"></textarea>

<label>Evolução</label>
<textarea id="pil_evolucao"></textarea>

</div>

<!-- ================= FISIOTERAPIA ================= -->
<div id="fisioterapia" class="hidden">

<h2>Avaliação Fisioterapêutica</h2>

<label>Queixa Principal</label>
<select id="fis_queixa">
  <option>Dor</option>
  <option>Limitação funcional</option>
  <option>Pós-operatório</option>
</select>
<textarea id="fis_queixa_obs"></textarea>

<label>História da Doença Atual</label>
<textarea id="fis_hda"></textarea>

<label>Diagnóstico Médico</label>
<textarea id="fis_diag_med"></textarea>

<label>Diagnóstico Fisioterapêutico</label>
<select id="fis_diag">
  <option>Musculoesquelético</option>
  <option>Neurológico</option>
  <option>Funcional</option>
</select>
<textarea id="fis_diag_obs"></textarea>

<label>MIT</label>
<select id="fis_mit">
  <option>Preservado</option>
  <option>Alterado</option>
</select>
<textarea id="fis_mit_obs"></textarea>

<label>ADM</label>
<select id="fis_adm">
  <option>Preservada</option>
  <option>Reduzida</option>
</select>
<textarea id="fis_adm_obs"></textarea>

<label>EVA (Dor)</label>
<select id="fis_eva">
  <option>0–2</option>
  <option>3–5</option>
  <option>6–8</option>
  <option>9–10</option>
</select>
<textarea id="fis_eva_obs"></textarea>

<label>Plano Terapêutico</label>
<textarea id="fis_plano"></textarea>

<label>Evolução</label>
<textarea id="fis_evolucao"></textarea>

</div>

<button onclick="salvar()">Salvar Avaliação</button>
</div>

<!-- ================= PACIENTES ================= -->
<div id="pacientes" class="hidden card">
  <div id="lista"></div>
</div>

<!-- ================= PRONTUÁRIO ================= -->
<div id="prontuario" class="hidden card">
  <button onclick="mostrar('pacientes')">Voltar</button>
  <div id="conteudo"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfi6m9kx0DumrsxSDA8tYeSi3hcDGj9r4",
  authDomain: "avaliafisio-45711.firebaseapp.com",
  databaseURL: "https://avaliafisio-45711-default-rtdb.firebaseio.com",
  projectId: "avaliafisio-45711",
  storageBucket: "avaliafisio-45711.firebasestorage.app",
  messagingSenderId: "195334619216",
  appId: "1:195334619216:web:fb78abeeef1de60d4ed155"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.mostrar = id=>{
  ["form","pacientes","prontuario"].forEach(s=>document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};

window.trocarTipo = ()=>{
  pilates.classList.add("hidden");
  fisioterapia.classList.add("hidden");
  document.getElementById(tipo.value).classList.remove("hidden");
};

window.salvar = ()=>{
  const pid = nome.value.toLowerCase().replace(/\s+/g,"_");
  const t = tipo.value;
  const r = push(ref(db,`pacientes/${pid}/avaliacoes/${t}`));
  set(r,{data:data.value,...Object.fromEntries(new FormData(form))});
  alert("Avaliação salva com sucesso!");
};

onValue(ref(db,"pacientes"),snap=>{
  lista.innerHTML="";
  snap.forEach(p=>{
    lista.innerHTML+=`
      <div class="paciente">
        <b>${p.key.replace(/_/g," ")}</b><br>
        <button onclick="ver('${p.key}')">Ver prontuário</button>
        <button onclick="apagar('${p.key}')">Apagar</button>
      </div>`;
  });
});

window.ver=id=>{
  conteudo.innerHTML=`<h2>${id.replace(/_/g," ")}</h2>`;
  onValue(ref(db,"pacientes/"+id+"/avaliacoes"),snap=>{
    snap.forEach(t=>{
      conteudo.innerHTML+=`<h3>${t.key}</h3>`;
      t.forEach(a=>{
        conteudo.innerHTML+=`<pre>${JSON.stringify(a.val(),null,2)}</pre>`;
      });
    });
    mostrar("prontuario");
  },{onlyOnce:true});
};

window.apagar=id=>{
  if(confirm("Deseja apagar este paciente?")){
    remove(ref(db,"pacientes/"+id));
  }
};
</script>

</body>
</html>
