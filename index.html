<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Prontuário – Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --lilas:#6a5acd;
  --ciano:#00bcd4;
  --bg:#eef1f7;
}
*{box-sizing:border-box}
body{
  margin:0; padding:20px; font-family:Arial, sans-serif; background:var(--bg);
}
header{
  background:linear-gradient(135deg,var(--lilas),var(--ciano));
  color:#fff; padding:16px; border-radius:12px; margin-bottom:20px;
}
header h1{margin:0}
.menu{display:flex; gap:10px; margin:15px 0}
button{
  background:var(--ciano); color:#fff; border:none;
  padding:10px 14px; border-radius:8px; cursor:pointer;
}
button.secondary{background:var(--lilas)}
.card{
  background:#fff; border-radius:12px; padding:18px;
  box-shadow:0 6px 14px rgba(0,0,0,.06); margin-bottom:16px;
}
h2{color:var(--lilas)}
h3{color:#444}
label{font-weight:bold; display:block; margin-top:10px}
input, select, textarea{
  width:100%; padding:10px; margin-top:6px;
  border-radius:8px; border:1px solid #ccc;
}
textarea{min-height:80px}
.hidden{display:none}
.list-item{
  background:#f5f7fb; padding:12px; border-radius:10px; margin-bottom:10px;
}
@media print{
  .menu, .no-print{display:none}
  body{background:#fff}
  .card{box-shadow:none}
}
</style>
</head>

<body>

<header>
  <h1>Prontuário – Studio</h1>
</header>

<div class="menu no-print">
  <button onclick="show('form')">Nova Avaliação</button>
  <button class="secondary" onclick="show('pacientes')">Pacientes</button>
</div>

<!-- FORMULÁRIO -->
<div id="form" class="card">
  <label>Tipo de Avaliação</label>
  <select id="tipo" onchange="trocarTipo()">
    <option value="pilates">Pilates</option>
    <option value="fisioterapia">Fisioterapia</option>
  </select>

  <h2>Identificação</h2>
  <label>Nome do Paciente</label><input id="nome">
  <label>Data</label><input type="date" id="data">
  <label>Telefone</label><input id="tel">

  <!-- PILATES -->
  <div id="pilates">
    <h2>Avaliação de Pilates</h2>

    <h3>Objetivo</h3>
    <select id="pil_obj">
      <option>Dor</option><option>Reabilitação</option>
      <option>Condicionamento</option><option>Prevenção</option>
    </select>
    <textarea id="pil_obj_obs" placeholder="Observações"></textarea>

    <h3>Avaliação Postural</h3>
    <select id="pil_post">
      <option>Alinhado</option><option>Assimetria</option>
    </select>
    <textarea id="pil_post_obs" placeholder="Observações"></textarea>

    <h3>EVA (Dor)</h3>
    <select id="pil_eva">
      <option>0–2</option><option>3–5</option><option>6–8</option><option>9–10</option>
    </select>
    <textarea id="pil_eva_obs" placeholder="Observações"></textarea>

    <h3>Plano Terapêutico</h3>
    <textarea id="pil_plano"></textarea>
  </div>

  <!-- FISIOTERAPIA -->
  <div id="fisioterapia" class="hidden">
    <h2>Avaliação Fisioterapêutica</h2>

    <h3>Queixa Principal</h3>
    <textarea id="fis_queixa"></textarea>

    <h3>Diagnóstico Fisioterapêutico</h3>
    <textarea id="fis_diag"></textarea>

    <h3>MIT</h3>
    <select id="fis_mit">
      <option>Preservado</option><option>Alterado</option>
    </select>
    <textarea id="fis_mit_obs" placeholder="Observações"></textarea>

    <h3>EVA (Dor)</h3>
    <select id="fis_eva">
      <option>0–2</option><option>3–5</option><option>6–8</option><option>9–10</option>
    </select>
    <textarea id="fis_eva_obs" placeholder="Observações"></textarea>

    <h3>Plano Terapêutico</h3>
    <textarea id="fis_plano"></textarea>
  </div>

  <button onclick="salvar()">Salvar Avaliação</button>
</div>

<!-- PACIENTES -->
<div id="pacientes" class="hidden card">
  <h2>Pacientes</h2>
  <div id="lista"></div>
</div>

<!-- PRONTUÁRIO -->
<div id="prontuario" class="hidden card">
  <div class="no-print">
    <button onclick="show('pacientes')">Voltar</button>
    <button onclick="window.print()">Imprimir / PDF</button>
  </div>
  <div id="conteudo"></div>

  <h2>Evoluções</h2>
  <label>Nova evolução</label>
  <textarea id="novaEvolucao"></textarea>
  <button onclick="salvarEvolucao()">Salvar evolução</button>

  <div id="evolucoes"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfi6m9kx0DumrsxSDA8tYeSi3hcDGj9r4",
  authDomain: "avaliafisio-45711.firebaseapp.com",
  databaseURL: "https://avaliafisio-45711-default-rtdb.firebaseio.com",
  projectId: "avaliafisio-45711",
  storageBucket: "avaliafisio-45711.firebasestorage.app",
  messagingSenderId: "195334619216",
  appId: "1:195334619216:web:fb78abeeef1de60d4ed155"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
let pacienteAtual = null;

window.show = id=>{
  ["form","pacientes","prontuario"].forEach(s=>document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};

window.trocarTipo = ()=>{
  pilates.classList.toggle("hidden", tipo.value!=="pilates");
  fisioterapia.classList.toggle("hidden", tipo.value!=="fisioterapia");
};

window.salvar = ()=>{
  const pid = nome.value.toLowerCase().replace(/\s+/g,"_");
  const dados = { tipo: tipo.value, data: data.value };
  const r = push(ref(db,`pacientes/${pid}/avaliacoes`));
  set(r,dados);
  alert("Avaliação salva!");
};

onValue(ref(db,"pacientes"), snap=>{
  lista.innerHTML="";
  snap.forEach(p=>{
    lista.innerHTML+=`
      <div class="list-item">
        <b>${p.key.replace(/_/g," ")}</b><br>
        <button onclick="ver('${p.key}')">Abrir prontuário</button>
      </div>`;
  });
});

window.ver = id=>{
  pacienteAtual = id;
  conteudo.innerHTML=`<h2>${id.replace(/_/g," ")}</h2>`;
  onValue(ref(db,`pacientes/${id}/avaliacoes`), s=>{
    s.forEach(a=>{
      conteudo.innerHTML+=`
        <p><b>Avaliação:</b> ${a.val().tipo} — ${a.val().data}</p>
      `;
    });
  },{onlyOnce:true});

  onValue(ref(db,`pacientes/${id}/evolucoes`), s=>{
    evolucoes.innerHTML="";
    s.forEach(e=>{
      evolucoes.innerHTML+=`
        <div class="list-item">
          <b>${e.val().data}</b><br>${e.val().texto}
        </div>`;
    });
  });

  show("prontuario");
};

window.salvarEvolucao = ()=>{
  const r = push(ref(db,`pacientes/${pacienteAtual}/evolucoes`));
  set(r,{ data:new Date().toLocaleDateString(), texto:novaEvolucao.value });
  novaEvolucao.value="";
};
</script>

</body>
</html>

