<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Prontuário Fisioterapia & Pilates</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --lilas:#7b6cf6;
  --ciano:#00cfe6;
  --bg:#eef2f8;
  --card:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  background:var(--bg);
}
header{
  background:linear-gradient(135deg,var(--lilas),var(--ciano));
  color:#fff;
  padding:20px;
  border-radius:16px;
  margin-bottom:20px;
}
header h1{margin:0}
.menu{
  display:flex;
  gap:10px;
  margin-bottom:20px;
}
button{
  background:var(--ciano);
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
}
button.secondary{background:var(--lilas)}
.card{
  background:var(--card);
  border-radius:16px;
  padding:22px;
  margin-bottom:20px;
  box-shadow:0 10px 20px rgba(0,0,0,.06);
}
h2{color:var(--lilas)}
h3{color:#444;margin-bottom:6px}
label{font-weight:bold;display:block;margin-top:10px}
input,select,textarea{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:10px;
  border:1px solid #ccc;
}
textarea{min-height:90px}
.hidden{display:none}
.item{
  background:#f5f7fc;
  padding:14px;
  border-radius:12px;
  margin-bottom:10px;
}
.no-print{}
@media print{
  .menu,.no-print{display:none}
  body{background:#fff}
  .card{box-shadow:none}
}
</style>
</head>

<body>

<header>
  <h1>Prontuário Clínico – Studio</h1>
</header>

<div class="menu no-print">
  <button onclick="show('form')">Nova Avaliação</button>
  <button class="secondary" onclick="show('pacientes')">Pacientes</button>
</div>

<!-- ================= FORMULÁRIO ================= -->
<div id="form" class="card">

<label>Tipo de Avaliação</label>
<select id="tipo" onchange="trocarTipo()">
  <option value="fisio">Fisioterapia</option>
  <option value="pilates">Pilates</option>
</select>

<h2>IDENTIFICAÇÃO</h2>
<label>Nome do Paciente</label><input id="nome">
<label>Data</label><input type="date" id="data">
<label>Telefone</label><input id="telefone">

<!-- ================= FISIOTERAPIA ================= -->
<div id="fisio">

<h2>AVALIAÇÃO FISIOTERAPÊUTICA</h2>

<h3>Queixa Principal</h3>
<textarea id="fisio_queixa"></textarea>

<h3>História da Doença Atual</h3>
<textarea id="fisio_hda"></textarea>

<h3>Antecedentes Pessoais</h3>
<textarea id="fisio_antecedentes"></textarea>

<h3>Inspeção</h3>
<textarea id="fisio_inspecao"></textarea>

<h3>Palpação</h3>
<textarea id="fisio_palpacao"></textarea>

<h3>Amplitude de Movimento (ADM)</h3>
<select id="fisio_adm">
  <option>Preservada</option>
  <option>Reduzida</option>
</select>
<textarea id="fisio_adm_obs" placeholder="Observações"></textarea>

<h3>Força Muscular</h3>
<select id="fisio_forca">
  <option>Preservada</option>
  <option>Diminuída</option>
</select>
<textarea id="fisio_forca_obs"></textarea>

<h3>MIT</h3>
<select id="fisio_mit">
  <option>Preservado</option>
  <option>Alterado</option>
</select>
<textarea id="fisio_mit_obs"></textarea>

<h3>Dor (EVA)</h3>
<select id="fisio_eva">
  <option>0–2</option>
  <option>3–5</option>
  <option>6–8</option>
  <option>9–10</option>
</select>
<textarea id="fisio_eva_obs"></textarea>

<h3>Testes Especiais</h3>
<textarea id="fisio_testes"></textarea>

<h3>Diagnóstico Fisioterapêutico</h3>
<textarea id="fisio_diag"></textarea>

<h3>Objetivos</h3>
<textarea id="fisio_objetivos"></textarea>

<h3>Plano Terapêutico</h3>
<textarea id="fisio_plano"></textarea>

</div>

<!-- ================= PILATES ================= -->
<div id="pilates" class="hidden">

<h2>AVALIAÇÃO DE PILATES</h2>

<h3>Objetivo do Pilates</h3>
<textarea id="pil_objetivo"></textarea>

<h3>Histórico de Dor</h3>
<textarea id="pil_dor"></textarea>

<h3>Avaliação Postural</h3>
<textarea id="pil_postura"></textarea>

<h3>Mobilidade</h3>
<textarea id="pil_mobilidade"></textarea>

<h3>Equilíbrio</h3>
<textarea id="pil_equilibrio"></textarea>

<h3>Dor (EVA)</h3>
<select id="pil_eva">
  <option>0–2</option>
  <option>3–5</option>
  <option>6–8</option>
  <option>9–10</option>
</select>
<textarea id="pil_eva_obs"></textarea>

<h3>Plano Terapêutico</h3>
<textarea id="pil_plano"></textarea>

</div>

<button onclick="salvar()">Salvar Avaliação</button>
</div>

<!-- ================= PACIENTES ================= -->
<div id="pacientes" class="hidden card">
  <h2>Pacientes</h2>
  <div id="lista"></div>
</div>

<!-- ================= PRONTUÁRIO ================= -->
<div id="prontuario" class="hidden card">
  <div class="no-print">
    <button onclick="show('pacientes')">Voltar</button>
    <button onclick="window.print()">Imprimir / PDF</button>
  </div>

  <div id="conteudo"></div>

  <h2>Evoluções</h2>
  <textarea id="novaEvolucao" placeholder="Evolução da aula"></textarea>
  <button onclick="salvarEvolucao()">Salvar evolução</button>

  <div id="evolucoes"></div>
</div> 
  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getDatabase,
  ref,
  push,
  set,
  onValue,
  remove
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAfi6m9kx0DumrsxSDA8tYeSi3hcDGj9r4",
  authDomain: "avaliafisio-45711.firebaseapp.com",
  databaseURL: "https://avaliafisio-45711-default-rtdb.firebaseio.com",
  projectId: "avaliafisio-45711",
  storageBucket: "avaliafisio-45711.firebasestorage.app",
  messagingSenderId: "195334619216",
  appId: "1:195334619216:web:fb78abeeef1de60d4ed155"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
let pacienteAtual = null;

/* ================= NAVEGAÇÃO ================= */
window.show = (id) => {
  ["form","pacientes","prontuario"].forEach(s =>
    document.getElementById(s).classList.add("hidden")
  );
  document.getElementById(id).classList.remove("hidden");
};

window.trocarTipo = () => {
  document.getElementById("fisio").classList.toggle("hidden", tipo.value !== "fisio");
  document.getElementById("pilates").classList.toggle("hidden", tipo.value !== "pilates");
};

/* ================= SALVAR AVALIAÇÃO ================= */
window.salvar = () => {
  if(!nome.value){
    alert("Informe o nome do paciente");
    return;
  }

  const pid = nome.value.toLowerCase().replace(/\s+/g,"_");
  const r = push(ref(db, `pacientes/${pid}/avaliacoes`));

  const dados = {
    tipo: tipo.value,
    data: data.value,
    telefone: telefone.value,

    fisio: {
      queixa: fisio_queixa.value,
      hda: fisio_hda.value,
      antecedentes: fisio_antecedentes.value,
      inspecao: fisio_inspecao.value,
      palpacao: fisio_palpacao.value,
      adm: fisio_adm.value,
      adm_obs: fisio_adm_obs.value,
      forca: fisio_forca.value,
      forca_obs: fisio_forca_obs.value,
      mit: fisio_mit.value,
      mit_obs: fisio_mit_obs.value,
      eva: fisio_eva.value,
      eva_obs: fisio_eva_obs.value,
      testes: fisio_testes.value,
      diagnostico: fisio_diag.value,
      objetivos: fisio_objetivos.value,
      plano: fisio_plano.value
    },

    pilates: {
      objetivo: pil_objetivo.value,
      dor: pil_dor.value,
      postura: pil_postura.value,
      mobilidade: pil_mobilidade.value,
      equilibrio: pil_equilibrio.value,
      eva: pil_eva.value,
      eva_obs: pil_eva_obs.value,
      plano: pil_plano.value
    }
  };

  set(r, dados);
  alert("Avaliação salva com sucesso!");
};

/* ================= LISTAR PACIENTES ================= */
onValue(ref(db,"pacientes"), snap => {
  lista.innerHTML = "";
  snap.forEach(p => {
    lista.innerHTML += `
      <div class="item">
        <b>${p.key.replace(/_/g," ")}</b><br>
        <button onclick="abrirProntuario('${p.key}')">Abrir prontuário</button>
        <button onclick="apagarPaciente('${p.key}')">Apagar</button>
      </div>
    `;
  });
});

/* ================= PRONTUÁRIO ================= */
window.abrirProntuario = (id) => {
  pacienteAtual = id;
  conteudo.innerHTML = `<h2>${id.replace(/_/g," ")}</h2>`;

  onValue(ref(db,`pacientes/${id}/avaliacoes`), snap => {
    snap.forEach(a => {
      const d = a.val();
      conteudo.innerHTML += `
        <div class="item">
          <b>Avaliação:</b> ${d.tipo}<br>
          <b>Data:</b> ${d.data}<br><br>

          <b>Queixa:</b> ${d.fisio.queixa}<br>
          <b>Diagnóstico:</b> ${d.fisio.diagnostico}<br>
          <b>Plano:</b> ${d.fisio.plano}
        </div>
      `;
    });
  }, { onlyOnce:true });

  onValue(ref(db,`pacientes/${id}/evolucoes`), snap => {
    evolucoes.innerHTML = "";
    snap.forEach(e => {
      evolucoes.innerHTML += `
        <div class="item">
          <b>${e.val().data}</b><br>
          ${e.val().texto}
        </div>
      `;
    });
  });

  show("prontuario");
};

/* ================= EVOLUÇÕES ================= */
window.salvarEvolucao = () => {
  if(!pacienteAtual){
    alert("Nenhum paciente selecionado");
    return;
  }
  const r = push(ref(db,`pacientes/${pacienteAtual}/evolucoes`));
  set(r,{
    data: new Date().toLocaleDateString(),
    texto: novaEvolucao.value
  });
  novaEvolucao.value = "";
};

/* ================= APAGAR ================= */
window.apagarPaciente = (id) => {
  if(confirm("Deseja apagar todo o prontuário deste paciente?")){
    remove(ref(db,`pacientes/${id}`));
  }
};
</script>

</body>
</html>
