<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Avaliação - Fisio & Pilates</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f6fb;padding:20px}
h1{text-align:center}
.menu{display:flex;gap:10px;margin-bottom:20px}
.menu button{flex:1;padding:12px;border:none;border-radius:6px;background:#4b3fd1;color:#fff}
section{background:#fff;padding:20px;border-radius:8px}
.hidden{display:none}
label{font-weight:bold;display:block;margin-top:10px}
input,textarea,select{width:100%;padding:8px;margin-top:5px}
textarea{min-height:70px}
.card{background:#f1f1f1;padding:15px;border-radius:6px;margin-bottom:10px}
hr{margin:25px 0}
</style>
</head>

<body>

<h1>Avaliação Fisioterapia & Pilates</h1>

<div class="menu">
  <button onclick="show('form')">Nova Avaliação</button>
  <button onclick="show('pacientes')">Pacientes</button>
</div>

<section id="form">

<label>Tipo de Avaliação</label>
<select id="tipo" onchange="trocarTipo()">
  <option value="fisioterapia">Fisioterapia</option>
  <option value="pilates">Pilates</option>
</select>

<hr>

<h2>Identificação</h2>
<label>Nome</label><input id="nome">
<label>Data da Avaliação</label><input type="date" id="data">
<label>Data de Nascimento</label><input id="nasc">
<label>Telefone</label><input id="tel">

<!-- ================== FISIOTERAPIA ================== -->
<div id="fisio">

<hr>
<h2>Fisioterapia — História Clínica</h2>
<label>Queixa Principal</label><textarea id="fisio_queixa"></textarea>
<label>HPP</label><textarea id="fisio_hpp"></textarea>
<label>Antecedentes Pessoais</label><textarea id="fisio_antP"></textarea>

<hr>
<h2>Fisioterapia — Avaliação</h2>
<label>Diagnóstico Fisioterapêutico</label><textarea id="fisio_diag"></textarea>
<label>MIT</label><textarea id="fisio_mit"></textarea>
<label>Dor (EVA)</label><input id="fisio_eva">
<label>Plano Terapêutico</label><textarea id="fisio_plano"></textarea>
<label>Evolução</label><textarea id="fisio_evolucao"></textarea>

</div>

<!-- ================== PILATES ================== -->
<div id="pilates" class="hidden">

<hr>
<h2>Pilates — Avaliação Física</h2>
<label>Convênio</label><input id="pil_conv">
<label>Peso</label><input id="pil_peso">
<label>Altura</label><input id="pil_altura">
<label>Pressão Arterial</label><input id="pil_pa">

<hr>
<h2>Pilates — Funcional</h2>
<label>Avaliação Postural</label><textarea id="pil_postura"></textarea>
<label>Testes Funcionais</label><textarea id="pil_testes"></textarea>
<label>Objetivos com Pilates</label><textarea id="pil_obj"></textarea>
<label>Plano Terapêutico</label><textarea id="pil_plano"></textarea>
<label>Evolução</label><textarea id="pil_evolucao"></textarea>

</div>

<button onclick="salvar()">Salvar Avaliação</button>
</section>

<section id="pacientes" class="hidden">
  <div id="lista"></div>
</section>

<section id="prontuario" class="hidden">
  <button onclick="show('pacientes')">⬅ Voltar</button>
  <div id="conteudo"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfi6m9kx0DumrsxSDA8tYeSi3hcDGj9r4",
  authDomain: "avaliafisio-45711.firebaseapp.com",
  databaseURL: "https://avaliafisio-45711-default-rtdb.firebaseio.com",
  projectId: "avaliafisio-45711",
  storageBucket: "avaliafisio-45711.firebasestorage.app",
  messagingSenderId: "195334619216",
  appId: "1:195334619216:web:fb78abeeef1de60d4ed155"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const lista = document.getElementById("lista");
const conteudo = document.getElementById("conteudo");

window.show = id => {
  ["form","pacientes","prontuario"].forEach(s=>document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};

window.trocarTipo = () => {
  fisio.classList.add("hidden");
  pilates.classList.add("hidden");
  document.getElementById(tipo.value).classList.remove("hidden");
};

window.salvar = () => {
  const id = nome.value.toLowerCase().replace(/\s+/g,"_");
  const t = tipo.value;
  const r = push(ref(db,`pacientes/${id}/avaliacoes/${t}`));

  const dados = t==="fisioterapia" ? {
    data:data.value,
    queixa:fisio_queixa.value,
    hpp:fisio_hpp.value,
    antP:fisio_antP.value,
    diag:fisio_diag.value,
    mit:fisio_mit.value,
    eva:fisio_eva.value,
    plano:fisio_plano.value,
    evolucao:fisio_evolucao.value
  } : {
    data:data.value,
    convenio:pil_conv.value,
    peso:pil_peso.value,
    altura:pil_altura.value,
    pa:pil_pa.value,
    postura:pil_postura.value,
    testes:pil_testes.value,
    obj:pil_obj.value,
    plano:pil_plano.value,
    evolucao:pil_evolucao.value
  };

  set(r,dados);
  alert("Avaliação salva!");
};

onValue(ref(db,"pacientes"),snap=>{
  lista.innerHTML="";
  snap.forEach(p=>{
    lista.innerHTML+=`
      <div class="card">
        <b>${p.key.replace(/_/g," ")}</b><br>
        <button onclick="ver('${p.key}')">Ver prontuário</button>
      </div>`;
  });
});

window.ver = id => {
  conteudo.innerHTML=`<h2>${id.replace(/_/g," ")}</h2>`;
  onValue(ref(db,"pacientes/"+id+"/avaliacoes"),snap=>{
    snap.forEach(tipo=>{
      conteudo.innerHTML+=`<h3>${tipo.key.toUpperCase()}</h3>`;
      tipo.forEach(a=>{
        const d=a.val();
        conteudo.innerHTML+=`
          <div class="card">
            <b>Data:</b> ${d.data}<br>
            <b>Plano:</b> ${d.plano}<br>
            <b>Evolução:</b> ${d.evolucao}
          </div>`;
      });
    });
    show("prontuario");
  },{onlyOnce:true});
};
</script>

</body>
</html>
