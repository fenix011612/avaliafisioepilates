<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Avaliação Fisio & Pilates</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f4f6fb;padding:20px}
h1{text-align:center}
.menu{display:flex;gap:10px;margin-bottom:20px}
.menu button{flex:1;padding:12px;border:none;border-radius:6px;background:#4b3fd1;color:#fff}
section{background:#fff;padding:20px;border-radius:8px}
.hidden{display:none}
label{font-weight:bold;margin-top:10px;display:block}
select,input,textarea{width:100%;padding:8px;margin-top:5px}
textarea{min-height:60px}
.card{background:#f1f1f1;padding:15px;border-radius:6px;margin-bottom:10px}
hr{margin:25px 0}
</style>
</head>

<body>

<h1>Sistema de Avaliação</h1>

<div class="menu">
  <button onclick="show('form')">Nova Avaliação</button>
  <button onclick="show('pacientes')">Pacientes</button>
</div>

<section id="form">

<label>Tipo de Avaliação</label>
<select id="tipo" onchange="trocarTipo()">
  <option value="pilates">Pilates</option>
  <option value="fisioterapia">Fisioterapia</option>
</select>

<hr>

<h2>Identificação</h2>
<label>Nome</label><input id="nome">
<label>Data</label><input type="date" id="data">
<label>Telefone</label><input id="tel">

<!-- ================= PILATES ================= -->
<div id="pilates">

<h2>Pilates – Avaliação</h2>

<label>Convênio</label>
<select id="pil_conv">
  <option>Particular</option>
  <option>Gympass</option>
  <option>TotalPass</option>
  <option>Outro</option>
</select>
<label>Observações</label><textarea id="pil_conv_obs"></textarea>

<label>Objetivo com Pilates</label>
<select id="pil_obj">
  <option>Dor</option>
  <option>Condicionamento</option>
  <option>Reabilitação</option>
  <option>Prevenção</option>
</select>
<label>Observações</label><textarea id="pil_obj_obs"></textarea>

<label>Avaliação Postural</label>
<select id="pil_post">
  <option>Alinhado</option>
  <option>Assimetria</option>
</select>
<label>Observações</label><textarea id="pil_post_obs"></textarea>

<label>Equilíbrio</label>
<select id="pil_eq">
  <option>Bom</option>
  <option>Regular</option>
  <option>Ruim</option>
</select>
<label>Observações</label><textarea id="pil_eq_obs"></textarea>

<label>Dor (EVA)</label>
<select id="pil_eva">
  <option>0–2</option>
  <option>3–5</option>
  <option>6–8</option>
  <option>9–10</option>
</select>
<label>Observações</label><textarea id="pil_eva_obs"></textarea>

<label>Plano Terapêutico</label><textarea id="pil_plano"></textarea>
<label>Evolução</label><textarea id="pil_evolucao"></textarea>

</div>

<!-- ================= FISIOTERAPIA ================= -->
<div id="fisioterapia" class="hidden">

<h2>Fisioterapia – Avaliação</h2>

<label>Queixa Principal</label>
<select id="fis_queixa">
  <option>Dor</option>
  <option>Limitação funcional</option>
  <option>Pós-operatório</option>
</select>
<label>Observações</label><textarea id="fis_queixa_obs"></textarea>

<label>Diagnóstico Fisioterapêutico</label>
<select id="fis_diag">
  <option>Musculoesquelético</option>
  <option>Neurológico</option>
  <option>Funcional</option>
</select>
<label>Observações</label><textarea id="fis_diag_obs"></textarea>

<label>MIT</label>
<select id="fis_mit">
  <option>Preservado</option>
  <option>Alterado</option>
</select>
<label>Observações</label><textarea id="fis_mit_obs"></textarea>

<label>Dor (EVA)</label>
<select id="fis_eva">
  <option>0–2</option>
  <option>3–5</option>
  <option>6–8</option>
  <option>9–10</option>
</select>
<label>Observações</label><textarea id="fis_eva_obs"></textarea>

<label>Plano Terapêutico</label><textarea id="fis_plano"></textarea>
<label>Evolução</label><textarea id="fis_evolucao"></textarea>

</div>

<button onclick="salvar()">Salvar Avaliação</button>
</section>

<section id="pacientes" class="hidden">
  <div id="lista"></div>
</section>

<section id="prontuario" class="hidden">
  <button onclick="show('pacientes')">⬅ Voltar</button>
  <div id="conteudo"></div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAfi6m9kx0DumrsxSDA8tYeSi3hcDGj9r4",
  authDomain: "avaliafisio-45711.firebaseapp.com",
  databaseURL: "https://avaliafisio-45711-default-rtdb.firebaseio.com",
  projectId: "avaliafisio-45711",
  storageBucket: "avaliafisio-45711.firebasestorage.app",
  messagingSenderId: "195334619216",
  appId: "1:195334619216:web:fb78abeeef1de60d4ed155"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.show = id => {
  ["form","pacientes","prontuario"].forEach(s=>document.getElementById(s).classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
};

window.trocarTipo = () => {
  pilates.classList.add("hidden");
  fisioterapia.classList.add("hidden");
  document.getElementById(tipo.value).classList.remove("hidden");
};

window.salvar = () => {
  const id = nome.value.toLowerCase().replace(/\s+/g,"_");
  const t = tipo.value;
  const r = push(ref(db,`pacientes/${id}/avaliacoes/${t}`));

  const dados = t==="pilates" ? {
    data:data.value,
    conv:pil_conv.value,conv_obs:pil_conv_obs.value,
    obj:pil_obj.value,obj_obs:pil_obj_obs.value,
    post:pil_post.value,post_obs:pil_post_obs.value,
    eq:pil_eq.value,eq_obs:pil_eq_obs.value,
    eva:pil_eva.value,eva_obs:pil_eva_obs.value,
    plano:pil_plano.value,
    evolucao:pil_evolucao.value
  } : {
    data:data.value,
    queixa:fis_queixa.value,queixa_obs:fis_queixa_obs.value,
    diag:fis_diag.value,diag_obs:fis_diag_obs.value,
    mit:fis_mit.value,mit_obs:fis_mit_obs.value,
    eva:fis_eva.value,eva_obs:fis_eva_obs.value,
    plano:fis_plano.value,
    evolucao:fis_evolucao.value
  };

  set(r,dados);
  alert("Avaliação salva!");
};

onValue(ref(db,"pacientes"),snap=>{
  lista.innerHTML="";
  snap.forEach(p=>{
    lista.innerHTML+=`
      <div class="card">
        <b>${p.key.replace(/_/g," ")}</b><br>
        <button onclick="ver('${p.key}')">Ver histórico</button>
      </div>`;
  });
});

window.ver = id => {
  conteudo.innerHTML=`<h2>${id.replace(/_/g," ")}</h2>`;
  onValue(ref(db,"pacientes/"+id+"/avaliacoes"),snap=>{
    snap.forEach(tipo=>{
      conteudo.innerHTML+=`<h3>${tipo.key}</h3>`;
      tipo.forEach(a=>{
        const d=a.val();
        conteudo.innerHTML+=`
          <div class="card">
            <b>Data:</b> ${d.data}<br>
            <b>Plano:</b> ${d.plano}<br>
            <b>Evolução:</b> ${d.evolucao}
          </div>`;
      });
    });
    show("prontuario");
  },{onlyOnce:true});
};
</script>

</body>
</html>
